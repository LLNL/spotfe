<html>
<head>
    <title></title>
</head>
<body>

    <main></main>
    <script src="./localforage.js"></script>
    <script src="./main.js"></script>
    <script>
        const params = new URLSearchParams(new URL(window.location).search)
        const runSetId = params.get("runSetId")
        const runId = params.get("runId")

        localforage.getItem(runSetId)
            .then(runSet => {
                const fileData = runSet.Runs[runId]
                for (const [key, val] of Object.entries(fileData.Globals)){
                    const type_ = runSet.RunGlobalMeta[key] ? runSet.RunGlobalMeta[key].type : "string"
                    fileData.Globals[key] = {value: fileData.Globals[key], type: type_ }
                }

                const flags = {filename: runId, data: fileData.Data, meta: fileData.Globals}
                return Elm.Main.init(
                    { node: document.querySelector('main')
                    , flags
                    }
                )
            })
        document.title = runSetId + " / " + runId

    </script>

</body>
</html>
