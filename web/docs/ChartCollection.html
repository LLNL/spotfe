<!DOCTYPE html>

<html>
<head>
  <title>ChartCollection.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ChartCollection.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">var</span> ST = ST || {};
<span class="hljs-keyword">var</span> runTable;

<span class="hljs-keyword">var</span> SHOW_MORE_INCREASE = <span class="hljs-number">100</span>;
ST.MAX_SHOW = SHOW_MORE_INCREASE;


<span class="hljs-keyword">var</span> dateFormatSpecifier = <span class="hljs-string">'%m/%d/%Y'</span>;
<span class="hljs-keyword">var</span> dateFormat = d3.timeFormat(dateFormatSpecifier);
<span class="hljs-keyword">var</span> dateFormatParser = d3.timeParse(dateFormatSpecifier);
ST.numberFormat = d3.format(<span class="hljs-string">'.2f'</span>);


ST.ChartCollection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p> Create Crossfilter Dimensions and Groups
 See the <a href="https://github.com/square/crossfilter/wiki/API-Reference">crossfilter API</a> for reference.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> amend_charts_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> ls </span>) </span>{

        <span class="hljs-keyword">if</span>( ls.scatterplots ) {

            <span class="hljs-keyword">var</span> dims_present = {};
            <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> x=<span class="hljs-number">0</span>;  x &lt; ls.charts.length; x++ ) {

                <span class="hljs-keyword">var</span> sp = ls.charts[x];
                dims_present[ sp.dimension.toLowerCase() ] = <span class="hljs-number">1</span>;
            }

            <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> z=<span class="hljs-number">0</span>; z &lt; ls.scatterplots.length; z++ ) {

                <span class="hljs-keyword">var</span> sp2 = ls.scatterplots[z];

                <span class="hljs-keyword">if</span>( !dims_present[sp2.dimension] ) {
                    ls.charts = ls.charts.concat(sp2);
                }
            }

        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p> Debug Data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> show_layout_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> lay </span>) </span>{

        <span class="hljs-keyword">var</span> ht = <span class="hljs-string">""</span>;

        <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> x <span class="hljs-keyword">in</span> lay.charts ) {
            ht += lay.charts[x].dimension + <span class="hljs-string">"  "</span>;
        }

        <span class="hljs-built_in">console</span>.log( ht );
    };


    <span class="hljs-keyword">var</span> RenderChartCollection = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">the_data, layout_spec</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>amend_charts_( layout_spec );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-built_in">console</span>.dir(the_data);
        <span class="hljs-keyword">var</span> GLOB_DAT = the_data;

        $(<span class="hljs-string">'.chart_container'</span>).html(<span class="hljs-string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p> ST.ReturnedDataStub.data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> ndx = crossfilter(the_data);
        <span class="hljs-keyword">var</span> all = ndx.groupAll();

        ST.NDX = ndx;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Dimension by full date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ST.dateDimension = ndx.dimension(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
            <span class="hljs-keyword">return</span> dateFormatParser(d.date);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p> Do Layoutspec validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!layout_spec.charts) {

            <span class="hljs-keyword">var</span> mes = layout_spec.chart ? <span class="hljs-string">"chart specification should be plural: charts, not chart.  "</span> : <span class="hljs-string">""</span>;
            alert(mes + <span class="hljs-string">'   &lt;b&gt;charts&lt;/b&gt; is not defined in layout file.'</span>)
        }


        <span class="hljs-keyword">if</span> (layout_spec.charts.length === <span class="hljs-literal">undefined</span>) {
            alert(<span class="hljs-string">'Layout charts must be of type array.'</span>);
        }

        <span class="hljs-keyword">var</span> layout_charts = layout_spec.charts;
        <span class="hljs-keyword">var</span> original_lc = layout_charts; <span class="hljs-comment">// $.extend(true, {}, layout_charts);</span>

        <span class="hljs-built_in">console</span>.dir(original_lc);

        ST.LayoutAugmenterModel.get(layout_charts, the_data);
        ST.UserPreferences.render();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> dimension <span class="hljs-keyword">in</span> layout_charts) {

            <span class="hljs-keyword">var</span> spec = layout_charts[dimension];
            <span class="hljs-keyword">var</span> viz = spec.viz;

            <span class="hljs-keyword">var</span> counts = count_unique_values_in_chart_( ndx, spec.dimension );
            spec.counts = counts;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p> keep disabled for now.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span>( viz === <span class="hljs-string">"PieChart"</span> &amp;&amp; counts &gt;= <span class="hljs-number">15</span> ) {
                viz = <span class="hljs-string">"HorizontalBarChart"</span>;
            }

            <span class="hljs-keyword">if</span> (ST[viz] &amp;&amp; ST[viz].render) {

                <span class="hljs-keyword">if</span>( spec.show ) {
                    ST[viz].render(ndx, spec);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Sorry.  Viz type viz='</span> + viz + <span class="hljs-string">' is not supported.'</span>);
            }
        }

        <span class="hljs-keyword">var</span> dataCount = dc.dataCount(<span class="hljs-string">'.dc-data-count'</span>);
        runTable = dc.dataTable(<span class="hljs-string">'.dc-data-table'</span>);

        dataCount <span class="hljs-comment">/* dc.dataCount('.dc-data-count', 'chartGroup'); */</span>
            .dimension(ndx)
            .group(all)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>(<em>optional</em>) <code>.html</code> sets different html when some records or all records are selected.
<code>.html</code> replaces everything in the anchor with the html given using the following function.
<code>%filter-count</code> and <code>%total-count</code> are replaced with the values obtained.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .html({
                <span class="hljs-attr">some</span>: <span class="hljs-string">'&lt;strong&gt;%filter-count&lt;/strong&gt; selected out of &lt;strong&gt;%total-count&lt;/strong&gt; records'</span> +
                    <span class="hljs-string">' | &lt;div class="reset_all"&gt;Reset All&lt;/div&gt;'</span>,
                <span class="hljs-attr">all</span>: <span class="hljs-string">'All records selected. Please click on the graph to apply filters.'</span>
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h4 id="data-table">Data Table</h4>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Create a data table widget and use the given css selector as anchor. You can also specify
an optional chart group for this chart to be scoped within. When a chart belongs
to a specific group then any interaction with such chart will only trigger redraw
on other charts within the same chart group.
<br>API: <a href="https://github.com/dc-js/dc.js/blob/master/web/docs/api-latest.md#data-table-widget">Data Table Widget</a></p>
<p>You can statically define the headers like in</p>
<pre><code class="lang-html">   <span class="hljs-comment">&lt;!-- anchor div for data table --&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'data-table'</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- create a custom header --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">'header'</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Date<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Open<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Close<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Change<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Volume<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- data rows will filled in here --&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>or do it programmatically using <code>.columns()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> columns = [];

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> z <span class="hljs-keyword">in</span> layout_spec.table) {

            <span class="hljs-keyword">var</span> tab = layout_spec.table[z];

            <span class="hljs-keyword">if</span>( tab.show ) {

                <span class="hljs-keyword">if</span> (tab.type === <span class="hljs-string">"date"</span>) {

                    columns.push({
                        <span class="hljs-attr">label</span>: tab.label,
                        <span class="hljs-attr">format</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cali_obj, spec</span>) </span>{

                            <span class="hljs-keyword">var</span> dimension = <span class="hljs-keyword">this</span>.label;
                            <span class="hljs-keyword">var</span> val = cali_obj[ dimension ];

                            <span class="hljs-keyword">return</span> ST.Utility.format_date(val);
                        }
                    });

                } <span class="hljs-keyword">else</span> {

                    columns.push(tab.dimension);
                }
            }
        }

        columns.push({
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Operations'</span>,
            <span class="hljs-attr">format</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{

                <span class="hljs-keyword">var</span> buts = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">var</span> title = {
                    <span class="hljs-string">"jupyter"</span> : <span class="hljs-string">"Jupyter View"</span>,
                    <span class="hljs-string">"walltime"</span> : <span class="hljs-string">"Walltime View"</span>,
                    <span class="hljs-string">"memory"</span>: <span class="hljs-string">"Memory View"</span>
                };

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x <span class="hljs-keyword">in</span> d.drilldown) {

                    <span class="hljs-keyword">var</span> but = d.drilldown[x];
                    <span class="hljs-keyword">var</span> drill_icon = but.toLowerCase();

                    buts += <span class="hljs-string">'&lt;div run_id="'</span> + d.run_id + <span class="hljs-string">'" '</span> +
                        <span class="hljs-string">'title="'</span> + title[ drill_icon ] + <span class="hljs-string">'" '</span> +
                        <span class="hljs-string">'subject="'</span> + drill_icon + <span class="hljs-string">'" class="drilldown myButton '</span> + drill_icon + <span class="hljs-string">' icon"&gt;'</span> +
                        <span class="hljs-string">'&lt;div class="inner"&gt;&lt;/div&gt;'</span> +
                        <span class="hljs-string">'&lt;/div&gt;'</span>;
                }

                <span class="hljs-keyword">var</span> hidden = <span class="hljs-string">'&lt;div class="hidden key" key="'</span> + d.key + <span class="hljs-string">'"&gt;'</span> + d.key + <span class="hljs-string">'&lt;/div&gt;'</span>;

                <span class="hljs-keyword">return</span> buts + hidden;
            }
        });


        ST.CompareArguments.render(the_data[<span class="hljs-number">0</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p> <a href="https://github.com/HamsterHuey/intothevoid.io/blob/master/code/2017/dcjs%20sortable%20table/dcjsSortableTable.html">https://github.com/HamsterHuey/intothevoid.io/blob/master/code/2017/dcjs%20sortable%20table/dcjsSortableTable.html</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        runTable
            .dimension(ST.dateDimension)</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Data table does not use crossfilter group but rather a closure
as a grouping function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .group(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{

                <span class="hljs-keyword">var</span> format = d3.format(<span class="hljs-string">'02d'</span>);
                <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d.date * <span class="hljs-number">1000</span>);  <span class="hljs-comment">// used to be epoch_date</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>return date.getFullYear() + ‘/‘ + format((date.getMonth() + 1));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
            })</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>(<em>optional</em>) max number of records to be shown, <code>default = 25</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .size(ST.MAX_SHOW)    <span class="hljs-comment">//  ST.params.max</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>There are several ways to specify the columns; see the data-table documentation.
This code demonstrates generating the column header automatically based on the columns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .columns(columns)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>(<em>optional</em>) sort using the given field, <code>default = function(d){return d;}</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .sortBy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{

                <span class="hljs-keyword">var</span> col = <span class="hljs-string">"runtime"</span>; <span class="hljs-comment">// "Region Balance";</span>
                <span class="hljs-keyword">return</span> d[col]; <span class="hljs-comment">// d.date;</span>
            })</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>(<em>optional</em>) sort order, <code>default = d3.ascending</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .order(d3.ascending)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>(<em>optional</em>) custom renderlet to post-process chart using <a href="http://d3js.org">D3</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .on(<span class="hljs-string">'renderlet'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">table</span>) </span>{

                table.selectAll(<span class="hljs-string">'.dc-table-group'</span>).classed(<span class="hljs-string">'info'</span>, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p> Make this happen after the render table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                jQuery(<span class="hljs-string">'.compare_button, .dc-table-column .drilldown'</span>).unbind(<span class="hljs-string">'click'</span>).bind(<span class="hljs-string">'click'</span>, ST.CallSpot.drilldown);

                bind_sort();
            });


        render_more_link_( the_data.length );

        ST.all_data = ST.dateDimension.top(<span class="hljs-number">80000</span>);
        <span class="hljs-built_in">console</span>.dir(ST.all_data);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>console.dir(runTable.top(80000));</p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>simply call <code>.renderAll()</code> to render all charts on the page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dc.renderAll();

        ST.BarChart.load_filter();
        ST.PieChart.load_filter();
        ST.LeftHorizontalBarChart.load_filter();
        ST.HorizontalBarChart.load_filter();
        ST.ScatterPlot.load_filter();

        dc.redrawAll();</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p> Only load this once, otherwise when you check/uncheck
 the load_compare will slow things down too much.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>( !ST.has_loaded_compare ) {

            ST.has_loaded_compare = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p> preload ST.str_cali_keys so you can click MJ right away.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ST.CallSpot.load_compare();
        }

        bind_sort();
        ST.EtcBucket.handle_etc_buckets();
    };


    <span class="hljs-keyword">var</span> reset_all_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

        dc.filterAll();
        dc.renderAll();

        ST.UrlStateManager.remove_all_chart_pars();</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p> The horizontal charts  have a slightly different structure where the reset link
 is not inside the div that gets redrawn, so we need to manually hide the horizontal reset link.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'.horiz_reset'</span>).hide();
    };

    <span class="hljs-keyword">var</span> render_more_link_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> count </span>) </span>{

        <span class="hljs-keyword">var</span> show = ST.MAX_SHOW &lt;= count ? <span class="hljs-string">'show'</span> : <span class="hljs-string">'hide'</span>;
        $(<span class="hljs-string">'.contain_show_more'</span>)[show]();
    };


    <span class="hljs-keyword">var</span> count_unique_values_in_chart_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> ndx, dimension </span>) </span>{

        <span class="hljs-keyword">var</span> uniq_counts = {};

        <span class="hljs-keyword">var</span> ndim = ndx.dimension(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cali_object</span>) </span>{

            uniq_counts[ cali_object[ dimension ] ] = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">return</span> cali_object[ dimension ];
        });

        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys( uniq_counts ).length;
    };


    <span class="hljs-keyword">var</span> get_chart_type_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> par </span>) </span>{

        <span class="hljs-keyword">if</span>( par.hasClass(<span class="hljs-string">'scatter-chart'</span>) ) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"scatter"</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-string">"other"</span>;
    };


    <span class="hljs-keyword">var</span> bind_sort = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>$(‘rect’).attr(“onmousemove”, “ST.Utility.show_tooltip(evt, ‘This is blue’);”)
   .attr(‘onmouseout’, “ST.Utility.hide_tooltip();”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        $(<span class="hljs-string">'.chart_container .popup_menu'</span>).unbind(<span class="hljs-string">'click'</span>).bind(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

            <span class="hljs-keyword">var</span> par = $(<span class="hljs-keyword">this</span>).parent();
            <span class="hljs-keyword">var</span> grand = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">".outer_cont"</span>);

            <span class="hljs-keyword">var</span> dim = par.attr(<span class="hljs-string">'chart-dimension'</span>);
            <span class="hljs-keyword">var</span> is_scatter_chart = par.hasClass(<span class="hljs-string">'scatter-chart'</span>);
            <span class="hljs-keyword">var</span> x_label = par.find(<span class="hljs-string">'.x-label'</span>).html();
            <span class="hljs-keyword">var</span> y_label = par.find(<span class="hljs-string">'.y-label'</span>).html();
            <span class="hljs-keyword">var</span> chart_name = grand.find(<span class="hljs-string">'.text_chart_name'</span>).html();

            ST.AddChartTypeView.render( <span class="hljs-literal">true</span>, {
                <span class="hljs-attr">chart_name</span>: chart_name,
                <span class="hljs-attr">chart_type</span>: get_chart_type_( par ),
                <span class="hljs-attr">dimension</span>: dim,
                <span class="hljs-attr">is_scatter_chart</span>: is_scatter_chart,
                <span class="hljs-attr">x_label</span>: x_label,
                <span class="hljs-attr">y_label</span>: y_label
            } );
        });

        $(<span class="hljs-string">'.reset_all'</span>).unbind(<span class="hljs-string">'click'</span>).bind(<span class="hljs-string">"click"</span>, reset_all_);

        $(<span class="hljs-string">'.contain_show_more a'</span>).unbind(<span class="hljs-string">'click'</span>).bind(<span class="hljs-string">'click'</span>, ST.ChartCollection.show_more);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p> for some reason, dc.js capitalizes column headings, thus messing up the sort
 reference when they click on the arrow click.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> normalize_indexes_ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{

            <span class="hljs-keyword">var</span> nobj = {};

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x <span class="hljs-keyword">in</span> obj) {
                <span class="hljs-keyword">var</span> lower = x.toLowerCase();
                nobj[lower] = obj[x];
            }

            <span class="hljs-keyword">return</span> nobj;
        };


        $(<span class="hljs-string">'.dc-data-table th'</span>).ArrowFunctions({
            <span class="hljs-attr">arrow_click</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sort_me</span>(<span class="hljs-params"></span>) </span>{

                <span class="hljs-keyword">var</span> target = $(event.target);
                <span class="hljs-keyword">var</span> is_up = target.hasClass(<span class="hljs-string">'up_arrow'</span>);
                <span class="hljs-keyword">var</span> what_sort = target.parent().html();

                what_sort = what_sort.split(<span class="hljs-string">'&lt;'</span>)[<span class="hljs-number">0</span>].toLowerCase();

                runTable.size(<span class="hljs-literal">Infinity</span>).sortBy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{

                    <span class="hljs-keyword">var</span> nobj = normalize_indexes_(d);

                    <span class="hljs-keyword">var</span> col = <span class="hljs-string">"Region Balance"</span>;
                    <span class="hljs-keyword">return</span> nobj[what_sort]; <span class="hljs-comment">// d.date;</span>
                })
                    .order(is_up ? d3.ascending : d3.descending);

                dc.renderAll();
                dc.redrawAll();

                bind_sort();
                ST.EtcBucket.handle_etc_buckets();
            }
        });
    };


    <span class="hljs-keyword">var</span> show_more_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

        ST.MAX_SHOW += SHOW_MORE_INCREASE;
        ST.ChartCollection.RenderChartCollection(ST.newp, ST.layout_used);
    };

    <span class="hljs-keyword">var</span> setup_pars_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">var</span> xaxis = ST.Utility.get_param(<span class="hljs-string">'xaxis'</span>);
        <span class="hljs-keyword">var</span> groupby = ST.Utility.get_param(<span class="hljs-string">'groupby'</span>);
        <span class="hljs-keyword">var</span> yaxis = ST.Utility.get_param(<span class="hljs-string">'yaxis'</span>);
        <span class="hljs-keyword">var</span> aggregate = ST.Utility.get_param(<span class="hljs-string">'aggregate'</span>);
        yaxis = <span class="hljs-built_in">decodeURIComponent</span>(yaxis);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>yaxis = yaxis.replace(‘\%25252523’, ‘#’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">if</span>( defined_(xaxis) ) {
            ST.graph.setXaxis(xaxis);
        }

        <span class="hljs-keyword">if</span>( defined_(groupby)) {
            ST.graph.setGroupBy(groupby);
        }

        <span class="hljs-keyword">if</span>( defined_(yaxis)) {
            ST.graph.setYAxis(yaxis);
        }

        <span class="hljs-keyword">if</span>( defined_(aggregate)) {
            ST.graph.setAggregateType(aggregate);
        }
    };

    <span class="hljs-keyword">var</span> defined_ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> str </span>) </span>{
        <span class="hljs-keyword">return</span> str !== <span class="hljs-literal">undefined</span> &amp;&amp; str !== <span class="hljs-string">"undefined"</span>;
    };


    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">var</span> file = ST.Utility.get_file();
        ST.Utility.init_params();

        help_icon_(file, ST.params);

        <span class="hljs-keyword">var</span> host = ST.Utility.get_default_machine();
        <span class="hljs-keyword">var</span> machine = ST.Utility.get_param(<span class="hljs-string">'machine'</span>);
        <span class="hljs-keyword">var</span> command = ST.Utility.get_command();

        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'command='</span> + command);

        host = machine || host;

        ST.graph = <span class="hljs-keyword">new</span> Graph(<span class="hljs-string">'#compare_bottom_outer'</span>);

        ST.graph.getData(host, command, file)
            .then(<span class="hljs-function"><span class="hljs-params">summary</span> =&gt;</span> {

                ST.Utility.check_error( summary );
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'summary:'</span>, summary);
                ST.CallSpot.handle_success2(summary);

            }).finally( <span class="hljs-function"><span class="hljs-params">summary</span> =&gt;</span> {
                ST.Utility.check_error( summary );
        });

        setup_pars_();</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>listen from chart</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ST.graph.addXAxisChangeListener(<span class="hljs-function"><span class="hljs-params">xAxis</span> =&gt;</span> {

            <span class="hljs-keyword">if</span>( xAxis !== <span class="hljs-string">"undefined"</span> ) {
                ST.UrlStateManager.update_url(<span class="hljs-string">'xaxis'</span>, xAxis);
            }
        });

        ST.graph.addYAxisChangeListener(<span class="hljs-function"><span class="hljs-params">yAxis</span> =&gt;</span> {

            <span class="hljs-keyword">if</span>( yAxis !== <span class="hljs-string">"undefined"</span> ) {
                <span class="hljs-keyword">var</span> component = <span class="hljs-built_in">encodeURIComponent</span>(yAxis);
                ST.UrlStateManager.update_url(<span class="hljs-string">'yaxis'</span>, component);
            }
        });

        ST.graph.addAggregateTypeChangeListener(<span class="hljs-function"><span class="hljs-params">agg</span> =&gt;</span>{

            <span class="hljs-keyword">if</span>( agg !== <span class="hljs-string">"undefined"</span> ) {
                ST.UrlStateManager.update_url(<span class="hljs-string">'aggregate'</span>, agg);
            }
        });

        ST.graph.addGroupByChangeListener(<span class="hljs-function"><span class="hljs-params">groupBy</span> =&gt;</span> {

            <span class="hljs-keyword">if</span>( groupBy !== <span class="hljs-string">"undefined"</span> ) {
                ST.UrlStateManager.update_url(<span class="hljs-string">'groupby'</span>, groupBy);
            }
        });

        <span class="hljs-keyword">if</span>( ENV.turn_off_add_chart_feature ) {
            $(<span class="hljs-string">'body'</span>).addClass(<span class="hljs-string">'turn_off_add_chart_feature'</span>);
        }
    };

    $(<span class="hljs-built_in">document</span>).ready(init);


    $.fn.ArrowFunctions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{

        <span class="hljs-keyword">var</span> arrows = <span class="hljs-string">"&lt;div class='up_arrow'&gt;&lt;/div&gt;"</span> +
            <span class="hljs-string">"&lt;div class='down_arrow'&gt;&lt;/div&gt;"</span>;

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

            $(<span class="hljs-keyword">this</span>).append(arrows);
            $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.up_arrow, .down_arrow'</span>).unbind(<span class="hljs-string">'click'</span>).bind(<span class="hljs-string">'click'</span>, obj.arrow_click);
        });
    };


    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">show_more</span>: show_more_,
        <span class="hljs-attr">RenderChartCollection</span>: RenderChartCollection,
        <span class="hljs-attr">bind_sort</span>: bind_sort
    }
}();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
